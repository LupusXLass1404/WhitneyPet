<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    .gold {
      color: gold;
    }
    .red {
      color: red;
    }
    .pink {
      color: rgb(241, 25, 104);
    }

  </style>
  <title>差分文本檢視系統</title>
</head>
<body>
  <div id="main"></div><!-- 放主選單 -->
  <button class="button" data-passage="start" type="button">Start</button>
  
  <div id="passage"></div><!-- 文本 -->
  <div id="variant"></div><!-- 變數 -->

  <script>
    // 他把你推到牆上。
    // 他說：「［（高愛）你真的很可愛，［（男）男孩／（女）女孩］。／（低愛）我討厭你，［（男）渾蛋／（女）寶寶］。］」

    // 有人把你推到了墙上。你转身面对罪魁祸首，但他直接固定住了你的双臂。是惠特尼，一个有名的不良学生。 "别再挡我的路，"他说道，他的金色碎发遮住了一边眼睛，但他毫不在意，他的朋友们站在他两侧。"否则我会让你明白你的地位，［（男）男孩／（女）女孩］。"
    // <br><br>
    // 他将他的膝盖压入你的胯部片刻，［（生理性別與外表性別一致）然后松开了你／（生理性別與外表性別不同）皱着眉头停顿了一会儿才松开你］。他和他朋友们离开了，但你怀疑这一切只是开始。 | + 性欲 | + 创伤 | + 压力

    let text = {
      cp: `
        有人把你推到了墙上。你转身面对罪魁祸首，但他直接固定住了你的双臂。是惠特尼，一个有名的不良学生。 "别再挡我的路，"他说道，他的金色碎发遮住了一边眼睛，但他毫不在意，他的朋友们站在他两侧。"否则我会让你明白你的地位。"
        <br><br>
        他将他的膝盖压入你的胯部片刻，［（生理性別與外表性別一致）然后松开了你，［（男）男孩／（女）女孩］。／（生理性別與外表性別不同）皱着眉头停顿了一会儿才松开你］。他和他朋友们离开了，但你怀疑这一切只是开始。 | + 性欲 | + 创伤 | + 压力
      `,
    }
// ［（link／支配>10）高支］
// ［（link／支配<10）低支］
// ［（rng）你很可愛／你很美／你很火辣］
    let textt;

    function variantObj() {
    }

    // 我覺得我可以把一個［］內的物件全部選取，提取。然後再搜尋這個物件一次。直到沒有［］才跳出迴圈
    // 由於每次進入一個新的段落都會迴圈一次，所以id可以重複用
    // 會在［］的地點留下錨點


    // 或許應該在每一次按按鈕都要偵測一次，這樣才可以在相對應的差分有相對應的連結
    // 條件連結應該要一樣，這樣才能同時改變同一個條件的文字

    // 會一次又一次第偵測passage的內容，直到沒有任何的［］存在

    // 首先先把文本輸入進passage，
    // 最後要把passage清除。
    // 主選單表要跟main分開

    let passageID = document.getElementById('passage');
    let passage = document.querySelector(`[data-passage="start"]`);
    passage.addEventListener('click', function() {
      passageCheck(); 
    });

    
      passageID.innerHTML = text.cp;
      

      let regex = /［（(\W+)）(.*?)］/g;
      // let matches = passageID.innerHTML.match(regex);
      let matches = passageID.innerHTML.match(regex);
      // console.log("matches: " + matches);

      
        // 刪除最外圍的［］
        let content = matches[0].replace(/^［|］$/g, '');
        // console.log("content: " + content);
        // 去除［］內的內容
        let cleanContent = content.replace(regex, '');
        // console.log("cleanContent: " + cleanContent);
        // 抓取（）內的內容
        let matcheVariant = [...cleanContent.matchAll(/（(.*?)）/g)];
        // console.log(matcheLink);

        let variant = [];
        matcheVariant.forEach(match => {
          variant.push(match[1]);
          // console.log(match[1]);
          
         
        });
        console.log(variant);





        
       

       
        


        // let content = matches[0].match(/\（(.+?)\）/g);

        

        
        // matchelike
        if (passageID.innerHTML.match(regex)){
      }

    function passageCheck() {
    }

    


    function passageShow() {
      let content = text.cp;
      let match = content.match(/［（(.*?)］/g);

      content = content.replace(/［(.*?)］/g, '<span class="replace"></span>');
      match = match[0].replace(/［(.*?)］/g, '$1');
      match = match.split('／');

      // 
      // console.log(match);
      // console.log(content);
      document.getElementById('main').innerHTML = content;

      let tag = []

      match.forEach((value, index) => {
        // console.log(`value: ${value}, index: ${index}`);
        let temp = value.match(/（(.*?)）/g);
        let temp2 = temp[0].replace(/（(.*?)）/g, '$1');
        // console.log(temp);

        tag.push(temp2);
        document.getElementById('variant').insertAdjacentHTML('beforeend', `<button class="button" data-cond="${temp2}_${index}" type="button">${temp2}</button>`);

        let button = document.querySelector(`[data-cond="${temp2}_${index}"]`);
        console.log(button);

        if(index == 0){
          document.querySelector('span.replace').innerHTML = `${value}`;
        }

        button.addEventListener('click', function() {
          document.querySelector('span.replace').innerHTML = `${value}`;
        });



      })






    }

    

  </script>
</body>
</html>
