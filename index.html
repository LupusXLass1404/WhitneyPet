<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文本檢視器</title>

    <style>
        .link {
            cursor: pointer;
            color: #5888dd;
        }

        .link:hover {
            text-decoration: underline;
        }

        .gold {
            color: #ffd700;
        }

        .light {
            box-shadow: 0 0 10px 2px rgba(0, 0, 0, 0.5);
        }
    </style>

</head>

<body>
    <div id="main"></div><br />
    <!-- <div id="diffTip">目前差分：</div> -->
    <div id="diff">Diff：</div><br />
    <div id="text">Text：</div><br />
    <div id="opts">Opts：</div><br />
    <div id="show"><button>返回</button></div>
    <!-- <h2>告白</h2>
    <p id="main">操場｜小巷｜噴水池</p> -->


    <script>
        // eventscourtyard
        // bullyeventstreet
        // schoolbully

        let Main = '';
        let Diff = {};
        let mainId = document.getElementById('main');
        let diffId = document.getElementById('diff');
        let textId = document.getElementById('text');
        let OptsId = document.getElementById('opts');
        let mainLink = [
            // {
            //     h2: '',
            //     h3: '',
            //     link: [
            //         '',
            //         ''
            //     ],
            //     id: [
            //         '',
            //         '',
            //     ]
            // },
            // {
            //     h2: '學霸',
            //     h3: '',
            //     link: [
            //         '學齡1',
            //         '學齡2'
            //     ],
            //     id: [
            //         'whitneySchoolBully1',
            //         'whitneySchoolBully2',
            //     ]
            // },
            // {
            //     h2: '節日',
            //     h3: '萬聖節',
            //     link: [
            //         '惠特尼的萬聖節',
            //         '凱拉爾的萬聖節'
            //     ],
            //     id: [
            //         'Kla',
            //         'Klaa',
            //     ]
            // },
            // {
            //     h2: '放逐',
            //     h3: '',
            //     link: [
            //         '暈倒',
            //         '詢問發生了什麼事',
            //         '尋人啟事'
            //     ],
            //     id: [
            //         'whitney1',
            //         'whitney3',
            //         'whitney2',
            //     ]
            // },
            {
                h2: '告白',
                h3: '',
                link: [
                    '操場',
                    '小巷',
                    '噴水池'
                ],
                id: [
                    'whitneyConfessCourtyard',
                    'whitneyConfessStreet',
                    'whitneyConfessPark',
                ]
            }
        ]

        let commonText = {
            red: '<span class="red">壓力</span>',
        }

        let diffOut1 = '';
        let diffOut2 = '';
        let diffOut3 = '';

        let diff = {
            // whitneyConfessCourtyard: {
            //     link: [
            //         [
            //             '跑步',
            //             '打籃球'
            //         ], [
            //             '喜歡',
            //             '不喜歡'
            //         ], [
            //             '溫順',
            //             '中立',
            //             '抗拒'
            //         ], [
            //             '男LI',
            //             '女LI'
            //         ]
            //     ],
            //     text: [
            //         [
            //             '跑100米',
            //             '丟籃板球'
            //         ], [
            //             '喜歡很久',
            //             '討厭'
            //         ], [
            //             '溫柔',
            //             '急切',
            //             '自信'
            //         ], [
            //             '男',
            //             '女'
            //         ]
            //     ]
            // },

            whitneyConfessCourtyard: [
                [
                    ['跑步', '跑100米'],
                    ['打籃球', '丟籃板球']
                ], [
                    ['喜歡', '喜歡很久', `你交到${diffOut1}朋友了`],
                    ['不喜歡', '討厭', `你沒交到朋友`]
                ], [
                    ['溫順', '溫柔'],
                    ['中立', '急切'],
                    ['抗拒', '自信']
                ], [
                    ['男LI', '男'],
                    ['女LI', '女']
                ]
            ],
            whitneyConfessStreet: [
                [
                    ['你不好',]
                ],
            ],
            whitneyConfessPark: [
                [
                    ['你好',]
                ],
            ],
        }
        console.log


        // <p>你在［跑步、打籃球］，</p><p>你［不喜歡／喜歡］的人跟你告白，</p><p>你［溫順／普通／抗拒］的回復。</p>［<span class="gold">你交到［男／女］朋友了</span>］
        // 不喜歡就不會出現最後一行，喜歡就會出現最後一行
        // 
        // `<p>你在${linkId[0][1]}，</p><p>你${好感}的人跟你告白，</p><p>你${態度}的回復。</p>${好感${性別}}




        // console.log(mainLink[0].link); //測試json用

        // 首頁
        function main() {
            for (i = 0; i < mainLink.length; i++) {
                // 插入首頁標題
                Main += `<h2>${mainLink[i].h2}</h2>`;
                Main += `<h3>${mainLink[i].h3}</h3>`;
                // 插入首頁連結
                for (n = 0; n < mainLink[i].link.length; n++) {
                    let linkId = mainLink[i].id[n];
                    Main += `<span id="${linkId}" class="link">${mainLink[i].link[n]}</span>`;

                    // 首頁連結插入分隔號，但最後一個不要插入
                    if (n !== (mainLink[i].link.length - 1)) {
                        Main += `｜`;
                    }
                    // 更新首頁文字
                    mainId.innerHTML = Main;

                    // 建構差分選項
                    let diffStr = '';
                    for (d = 0; d < diff[`${linkId}`].length; d++) {
                        // console.log(diff[`${linkId}`][d]);
                        for (a = 0; a < diff[`${linkId}`][d].length; a++) {
                            // console.log(diff[`${linkId}`][d][a][0]);
                            diffStr += `<span id="${linkId}Diff_${d}_${a}" class="link">${diff[`${linkId}`][d][a][0]}</span>｜`;
                            for (l = 1; l < diff[`${linkId}`][d][a].length; l++) {
                                console.log(diff[`${linkId}`][d][a][l]);
                                diff[`${linkId}`][d][a][l] = `<span class="${linkId}Text_${d}_${a}">${diff[`${linkId}`][d][a][l]}</span>`
                            }
                        }
                    }
                    Diff[`${linkId}`] = `${diffStr}`;
                    // console.log(Diff[`${linkId}`]);
                }
            }
            for (let key in Diff) {
                // console.log(`${key}: ${Diff[key]}`);
                diffId.innerHTML += `${key}: ${Diff[key]}`;
            }
            mainChange();
            diffHide();
            textHide();
        }

        // 初始化
        main();

        // 首頁點擊事件
        for (i = 0; i < mainLink.length; i++) {
            for (n = 0; n < mainLink[i].link.length; n++) {
                let linkId = mainLink[i].id[n];
                document.getElementById(linkId).onclick = function () {
                    mainHide();
                    textChange(linkId);
                };

            }
        }

        // 差分點擊事件
        function diffClick(item) {
            for (d = 0; d < diff[`${item}`].length; d++) {
                // console.log(diff[`${linkId}`][d]);
                for (a = 0; a < diff[`${item}`][d].length; a++) {
                    // console.log(linkId + d + '_' + a);
                    document.getElementById(`${item}Diff_${d}_${a}`).onclick = function () {
                        // console.log('點擊事件的 ID:', this.id);
                        textChange(item, this.id);
                    };
                }
            }
        }

        // 顯示首頁
        function mainShow() {
            mainId.style.display = 'block';
        }
        // 隱藏首頁
        function mainHide() {
            mainId.style.display = 'none';
        }
        // 顯示差分
        function diffShow() {
            diffId.style.display = 'block';
        }
        // 隱藏差分
        function diffHide() {
            diffId.style.display = 'none';
        }
        // 顯示文本
        function textShow() {
            textId.style.display = 'block';
        }
        // 隱藏文本
        function textHide() {
            textId.style.display = 'none';
        }
        // 顯示選項
        function optsShow() {
            optsId.style.display = 'block';
        }
        // 隱藏選項
        function optsHide() {
            optsId.style.display = 'none';
        }

        // 構建首頁
        function mainChange() {
            mainId.innerHTML = Main;
        }
        // 改變文本
        function textChange(item, itemId) {
            // console.log(item, itemId);
            let DI = diff[`${item}`];
            let type = 0;
            let T = {};

            for (let i = 0; i < DI.length; i++) {
                T[`${i}`] = 0;
            }

            // 使用正則表達式匹配並提取數字
            if (itemId !== undefined) {
                const num = itemId.match(/_(\d+)_(\d+)/);
                if (num) {
                    // num[1] 匹配第一個數字，num[2] 匹配第二個數字
                    type = parseInt(num[1], 10);
                    T[`${type}`] = parseInt(num[2], 10);
                    // console.log(type);
                    // console.log(T);
                }
            }

            let text = {
                whitneyConfessCourtyard:
                    `<p>你在${DI[0][T[0]][1]}，</p><p>你${DI[1][T[1]][1]}的人跟你告白，</p><p>你${DI[2][T[2]][1]}的回復。</p>${DI[1][T[1]][2]}`,
                whitneyConfessStreet:
                    `<p>你在巷口</p><p>你喜歡的人跟你表白</p><p><span class="gold">你交到女朋友了！</span></p>`,
                whitneyConfessPark:
                    `<p>你在公園</p><p>你喜歡的人跟你表達心意</p><p><span class="gold">你交到男女朋友了！</span></p>`,
            }

            mainHide();
            diffShow();
            textShow();
            diffId.innerHTML = Diff[item];
            textId.innerHTML = text[item];
            diffClick(item)

            if (itemId !== undefined) {
                const num = itemId.match(/_(\d+)_(\d+)/);
                if (num) {
                    // 讓變更的文字發光``
                    // console.log(`${item}Text_${num[1]}_${num[2]}`);
                    let lightText = document.getElementsByClassName(`${item}Text_${num[1]}_${num[2]}`);

                    console.log(lightText);
                    Array.from(lightText).forEach(function (element) {
                        element.classList.add('light');
                        // 指定時間後去掉發光效果
                        setTimeout(function () {
                            element.classList.remove("light");
                        }, 1000);
                    });
                }
            }
        }

        // 返回主頁的按鈕
        document.getElementById('show').onclick = function () {
            mainShow();
            diffHide();
            textHide();
        };
    </script>

</body>

</html>